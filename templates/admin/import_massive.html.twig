{% extends 'base.html.twig' %}

{% block title %}G√©n√©ration de Donn√©es Massives - Administration{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('styles/pages/admin.css') }}">
{% endblock %}

{% block body %}
<div class="admin-container">
    <div class="container">
        <!-- Header -->
        <div class="admin-header import-massive">
            <a href="{{ path('admin_oeuvres') }}" class="back-btn">
                ‚Üê Retour aux ≈ìuvres
            </a>
            <h1 class="admin-title">
                üè≠ Import Massif depuis MangaDx
            </h1>
            <p class="admin-subtitle">Importez de vraies ≈ìuvres depuis MangaDx pour alimenter rapidement votre base de donn√©es</p>
        </div>

        <!-- Flash Messages -->
        {% for type, messages in app.flashes %}
            {% for message in messages %}
                <div class="status-message {{ type == 'error' ? 'error' : type }}">
                    {% if type == 'success' %}‚úÖ{% elseif type == 'error' %}‚ùå{% elseif type == 'warning' %}‚ö†Ô∏è{% else %}‚ÑπÔ∏è{% endif %}
                    {{ message }}
                </div>
            {% endfor %}
        {% endfor %}

        <!-- Contenu principal -->
        <div class="admin-content">
            <div class="admin-grid">
                <!-- Formulaire de g√©n√©ration -->
                <div class="admin-card">
                    <h2 class="card-title">
                        üì• Importateur MangaDx
                    </h2>
                    
                    <form method="post" id="importForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="limit" class="form-label">
                                    Nombre d'≈ìuvres √† importer
                                </label>
                                <select class="form-select" id="limit" name="limit">
                                    <option value="5">5 ≈ìuvres (Test rapide)</option>
                                    <option value="10" selected>10 ≈ìuvres (Recommand√©)</option>
                                    <option value="20">20 ≈ìuvres (Base moyenne)</option>
                                    <option value="50">50 ≈ìuvres (Grosse base)</option>
                                    <option value="100">100 ≈ìuvres (√ânorme !)</option>
                                </select>
                                <div class="form-help">
                                    ≈íuvres r√©cup√©r√©es depuis l'API MangaDx avec leurs chapitres r√©els
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="category" class="form-label">
                                    Cat√©gorie d'≈ìuvres
                                </label>
                                <select class="form-select" id="category" name="category">
                                    <option value="popular" selected>üéØ Populaires (Les plus suivies)</option>
                                    <option value="latest">üÜï R√©centes (Nouvelles sorties)</option>
                                    <option value="random">üé≤ Al√©atoires (D√©couvertes)</option>
                                </select>
                                <div class="form-help">
                                    Type d'≈ìuvres √† importer depuis MangaDx
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Options avanc√©es
                            </label>
                            <div class="checkbox-group">
                                <div class="checkbox-item danger-checkbox">
                                    <input type="checkbox" id="force" name="force" value="1">
                                    <div class="checkbox-content">
                                        <h6>‚ö†Ô∏è Vider la base avant import</h6>
                                        <small>Supprime toutes les ≈ìuvres existantes ! Irr√©versible.</small>
                                    </div>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="dry_run" name="dry_run" value="1">
                                    <div class="checkbox-content">
                                        <h6>üîç Mode simulation</h6>
                                        <small>Aper√ßu des donn√©es sans les sauvegarder</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-actions">
                            <button type="button" class="btn btn-secondary" onclick="startSimulation()">
                                üîç Simulation d'import
                            </button>
                            <button type="button" class="btn btn-primary" onclick="startImport()">
                                üì• Importer depuis MangaDx
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Sidebar d'informations -->
                <div class="admin-sidebar">
                    <!-- Fonctionnalit√©s -->
                    <div class="admin-card">
                        <h3 class="card-title">
                            üéØ Qu'est-ce qui sera import√© ?
                        </h3>
                        <div class="feature-list">
                            <div class="feature-item">
                                <span class="feature-icon">üìö</span>
                                <div class="feature-content">
                                    <h6>≈íuvres authentiques</h6>
                                    <small>Vraies ≈ìuvres depuis MangaDx avec titres, descriptions et couvertures originales</small>
                                </div>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üë®‚Äçüé®</span>
                                <div class="feature-content">
                                    <h6>Auteurs officiels</h6>
                                    <small>Vrais auteurs et artistes r√©cup√©r√©s depuis la base MangaDx</small>
                                </div>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üé≠</span>
                                <div class="feature-content">
                                    <h6>Genres authentiques</h6>
                                    <small>Vrais genres officiels assign√©s par la communaut√© MangaDx</small>
                                </div>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üìñ</span>
                                <div class="feature-content">
                                    <h6>Chapitres r√©els</h6>
                                    <small>Chapitres existants avec num√©rotation et pages r√©elles disponibles</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function updateEstimates() {
    const limit = document.getElementById('limit').value;
    const timeElement = document.getElementById('estimatedTime');
    const sizeElement = document.getElementById('estimatedSize');
    const chaptersElement = document.getElementById('estimatedChapters');
    
    // Calculs approximatifs bas√©s sur le nombre d'≈ìuvres
    const chapters = limit * 12; // Moyenne de 12 chapitres par ≈ìuvre
    const sizeMB = Math.round(limit * 0.5); // ~0.5MB par ≈ìuvre
    const timeMinutes = Math.ceil(limit / 30); // ~30 ≈ìuvres par minute
    
    if (timeElement) timeElement.textContent = `~${timeMinutes} minute${timeMinutes > 1 ? 's' : ''}`;
    if (sizeElement) sizeElement.textContent = `~${sizeMB} MB`;
    if (chaptersElement) chaptersElement.textContent = `~${chapters}`;
}

function startSimulation() {
    document.getElementById('dry_run').checked = true;
    document.getElementById('importForm').submit();
}

function startImport() {
    document.getElementById('dry_run').checked = false;
    if (document.getElementById('force').checked) {
        if (!confirm('‚ö†Ô∏è ATTENTION ! Vous √™tes sur le point de supprimer TOUTES les ≈ìuvres existantes. Cette action est irr√©versible. √ätes-vous s√ªr ?')) {
            return;
        }
    }
    document.getElementById('importForm').submit();
}

// Mettre √† jour les estimations au changement de limit
document.getElementById('limit').addEventListener('change', updateEstimates);

// Initialisation
updateEstimates();
</script>
{% endblock %}