{% extends 'base.html.twig' %}

{% block title %}√âditer les r√¥les de {{ user.nom }} - Administration{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('styles/pages/admin.css') }}">
{% endblock %}

{% block body %}
<div class="admin-container">
    <div class="container">
        <!-- Header -->
        <div class="admin-header">
            <a href="{{ path('admin_users') }}" class="back-btn">
                ‚Üê Retour aux utilisateurs
            </a>
            <h1 class="admin-title">
                üëë Gestion des R√¥les
            </h1>
            <p class="admin-subtitle">Modifier les permissions de {{ user.nom }}</p>
        </div>

        <!-- Flash Messages -->
        {% for type, messages in app.flashes %}
            {% for message in messages %}
                <div class="status-message {{ type == 'error' ? 'error' : type }}">
                    {% if type == 'success' %}‚úÖ{% elseif type == 'error' %}‚ùå{% elseif type == 'warning' %}‚ö†Ô∏è{% else %}‚ÑπÔ∏è{% endif %}
                    {{ message }}
                </div>
            {% endfor %}
        {% endfor %}

        <!-- Formulaire d'√©dition des r√¥les -->
        <div class="admin-card">
            <h2 class="card-title">
                üîê R√¥les et Permissions
            </h2>

            {{ form_start(form) }}
                <div class="form-group">
                    <label class="form-label">
                        S√©lectionnez les r√¥les pour cet utilisateur :
                    </label>
                    <div class="form-help">
                        Les r√¥les d√©terminent les permissions de l'utilisateur dans l'application.
                    </div>
                </div>

                <div class="checkbox-group">
                    {% for choice in form.roles %}
                        <div class="checkbox-item role-option" data-role="{{ choice.vars.value }}">
                            {{ form_widget(choice, {'attr': {'onchange': 'toggleRoleSelection(this)'}}) }}
                            {{ form_label(choice) }}
                            <small class="role-description">
                                {% if choice.vars.value == 'ROLE_ADMIN' %}
                                    Acc√®s complet √† l'administration
                                {% elseif choice.vars.value == 'ROLE_MODERATOR' %}
                                    Mod√©ration du contenu
                                {% else %}
                                    Utilisateur standard
                                {% endif %}
                            </small>
                        </div>
                    {% endfor %}
                </div>

                <div class="admin-actions">
                    <a href="{{ path('admin_users') }}" class="btn btn-secondary">
                        ‚ùå Annuler
                    </a>
                    <button type="submit" class="btn btn-primary">
                        üíæ Enregistrer les modifications
                    </button>
                </div>
            {{ form_end(form) }}
        </div>
    </div>
</div>

<script>
function toggleRoleSelection(checkbox) {
    const roleOption = checkbox.closest('.role-option');
    if (checkbox.checked) {
        roleOption.classList.add('selected');
    } else {
        roleOption.classList.remove('selected');
    }
}

// Initialiser l'√©tat visuel des r√¥les
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
        toggleRoleSelection(checkbox);
    });
});
</script>
{% endblock %}