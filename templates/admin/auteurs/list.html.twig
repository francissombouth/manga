{% extends 'base.html.twig' %}

{% block title %}Gestion des Auteurs - Administration{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('styles/pages/admin.css') }}">
{% endblock %}

{% block body %}


<div class="admin-container">
    <div class="admin-content">
        <div class="admin-header">
            <h1 class="admin-title">ğŸ‘¥ Gestion des Auteurs</h1>
            
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-number">{{ total }}</div>
                    <div class="stat-label">Auteurs</div>
                </div>
            </div>
        </div>

        <!-- Flash Messages -->
        {% for type, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ type }}">{{ message }}</div>
            {% endfor %}
        {% endfor %}

        <!-- ContrÃ´les -->
        <div class="admin-controls">
            <form method="GET" class="search-form">
                <input type="text" name="search" value="{{ search }}" placeholder="Rechercher un auteur..." class="search-input">
                <button type="submit" class="btn btn-secondary">ğŸ” Rechercher</button>
                {% if search %}
                    <a href="{{ path('admin_auteurs') }}" class="btn btn-secondary">âŒ Effacer</a>
                {% endif %}
            </form>
            
            <a href="{{ path('admin_auteur_new') }}" class="btn btn-primary">
                â• Nouvel auteur
            </a>
        </div>

        <!-- Liste des auteurs -->
        {% if auteurs %}
            <div class="auteurs-grid">
                {% for auteur in auteurs %}
                    <div class="auteur-card">
                        <div class="auteur-header">
                            <div class="auteur-info">
                                <h3>
                                    {% if auteur.prenom %}{{ auteur.prenom }} {% endif %}{{ auteur.nom }}
                                    {% if auteur.nomPlume %}
                                        <span style="color: var(--text-secondary); font-size: 0.9rem; font-weight: normal;">
                                            ({{ auteur.nomPlume }})
                                        </span>
                                    {% endif %}
                                </h3>
                                <div class="auteur-meta">
                                    {% if auteur.nationalite %}
                                        <span>ğŸŒ {{ auteur.nationalite }}</span>
                                    {% endif %}
                                    {% if auteur.dateNaissance %}
                                        <span>ğŸ“… {{ auteur.dateNaissance|date('d/m/Y') }}</span>
                                    {% endif %}
                                    <span>ğŸ“š {{ auteur.oeuvres|length }} Å“uvre(s)</span>
                                </div>
                            </div>
                            
                            <div class="auteur-actions">
                                <a href="{{ path('admin_auteur_edit', {id: auteur.id}) }}" class="btn btn-secondary btn-sm">
                                    âœï¸ Ã‰diter
                                </a>
                                {% if auteur.oeuvres|length == 0 %}
                                    <form method="POST" action="{{ path('admin_auteur_delete', {id: auteur.id}) }}" style="display: inline;" onsubmit="return confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cet auteur ?')">
                                        <button type="submit" class="btn btn-danger btn-sm">
                                            ğŸ—‘ï¸ Supprimer
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>

                        {% if auteur.biographie %}
                            <div class="auteur-bio">
                                {{ auteur.biographie|length > 200 ? auteur.biographie|slice(0, 200) ~ '...' : auteur.biographie }}
                            </div>
                        {% endif %}

                        {% if auteur.oeuvres|length > 0 %}
                            <div class="auteur-stats">
                                <div class="stat-item">
                                    ğŸ“– {{ auteur.oeuvres|length }} Å“uvre(s) crÃ©Ã©e(s)
                                </div>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <h3>Aucun auteur trouvÃ©</h3>
                <p>{% if search %}Aucun auteur ne correspond Ã  votre recherche.{% else %}Aucun auteur n'a encore Ã©tÃ© crÃ©Ã©.{% endif %}</p>
                <a href="{{ path('admin_auteur_new') }}" class="btn btn-primary" style="margin-top: 1rem;">
                    â• CrÃ©er le premier auteur
                </a>
            </div>
        {% endif %}

        <!-- Pagination -->
        {% if total_pages > 1 %}
            <div class="pagination">
                {% if current_page > 1 %}
                    <a href="{{ path('admin_auteurs', {page: current_page - 1, search: search}) }}">â† PrÃ©cÃ©dent</a>
                {% endif %}
                
                {% for page in 1..total_pages %}
                    {% if page == current_page %}
                        <span class="current">{{ page }}</span>
                    {% else %}
                        <a href="{{ path('admin_auteurs', {page: page, search: search}) }}">{{ page }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if current_page < total_pages %}
                    <a href="{{ path('admin_auteurs', {page: current_page + 1, search: search}) }}">Suivant â†’</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %} 