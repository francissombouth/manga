{% extends 'base.html.twig' %}

{% block title %}MangaTh√®que - D√©couvrez les meilleurs mangas{% endblock %}

{% block body %}
<div class="main-container">
    <!-- Contenu principal -->
    <main>
        <!-- Header h√©ro√Øque -->
        <div class="collection-header">
            <h1 class="collection-title">üî• D√©couvrez les meilleurs mangas</h1>
            <p class="collection-subtitle">Powered by MangaDx - Une collection de milliers de mangas √† lire gratuitement</p>
            
            <!-- Barre de recherche int√©gr√©e -->
            <div style="margin-top: 2rem;">
                <form action="{{ path('mangadx_search') }}" method="GET" style="display: flex; justify-content: center; gap: 1rem; max-width: 600px; margin: 0 auto;">
                    <input type="text" name="q" placeholder="Rechercher un manga..." 
                           style="flex: 1; padding: 1rem; border-radius: 12px; border: 1px solid var(--border-color); background-color: var(--bg-card); color: var(--text-primary);" required>
                    <button type="submit" class="btn-primary" style="padding: 1rem 2rem; white-space: nowrap;">
                        üîç Rechercher
                    </button>
                </form>
            </div>
            
            <div class="collection-stats">
                <div class="stat-item">
                    <span class="stat-number">{{ totalMangas }}+</span>
                    <span class="stat-label">Mangas Disponibles</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ currentPage }}</span>
                    <span class="stat-label">Page Actuelle</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ totalPages }}</span>
                    <span class="stat-label">Pages Total</span>
                </div>
            </div>
        </div>

        <!-- Alertes d'information -->
        <div style="background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: var(--space-md); margin-bottom: var(--space-lg);">
            <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-xs);">
                <span style="color: #10b981;">‚úÖ</span>
                <strong style="color: var(--text-primary);">Contenu familial</strong>
            </div>
            <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">
                Seuls les mangas tout public et √† contenu suggestif l√©ger sont affich√©s. Le contenu √©rotique et pornographique est automatiquement exclu.
            </p>
            <div style="margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--border-color);">
                <small style="color: var(--text-muted);">
                    üîÑ Page {{ currentPage }}/{{ totalPages }} charg√©e le {{ "now"|date("d/m/Y √† H:i") }} ‚Ä¢ 
                    üåê API officielle : <code style="color: var(--accent-purple);">api.mangadx.org</code>
                </small>
            </div>
        </div>

        <!-- Section Popular Today -->
        <section class="section">
            <div class="section-header">
                <h2 class="section-title">
                    üî• Mangas Populaires
                </h2>
                {% if hasNextPage %}
                    <a href="{{ path('mangadx_home', {page: currentPage + 1}) }}" class="section-link">PAGE SUIVANTE</a>
                {% endif %}
            </div>

            {% if mangas is not empty %}
                <div class="manga-grid">
                    {% for manga in mangas %}
                        <div class="manga-card">
                            <a href="{{ path('mangadx_manga_show', {id: manga.id}) }}" style="text-decoration: none; color: inherit;">
                                <!-- Couverture du manga -->
                                <div class="manga-cover-container">
                                    {% if manga.cover_url %}
                                        <img src="{{ path('image_proxy') }}?url={{ manga.cover_url|url_encode }}" 
                                             alt="{{ manga.title }}" 
                                             class="manga-cover" 
                                             loading="lazy" 
                                             onerror="this.src='{{ path('image_proxy') }}';">
                                    {% else %}
                                        <div class="manga-cover" style="background: linear-gradient(45deg, #374151, #4b5563); display: flex; align-items: center; justify-content: center; color: #9ca3af; font-size: 3rem;">
                                            üìñ
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Informations du manga -->
                                <div class="manga-info">
                                    <h3 class="manga-title">{{ manga.title }}</h3>
                                    <p class="manga-author">
                                        {% if manga.authors %}
                                            {{ manga.authors|join(', ') }}
                                        {% else %}
                                            Auteur inconnu
                                        {% endif %}
                                    </p>

                                    <div class="manga-meta">
                                        <span class="manga-type">{{ manga.status|default('MANGA')|title }}</span>
                                        {% if manga.year %}
                                            <span class="chapters-count">{{ manga.year }}</span>
                                        {% endif %}
                                    </div>

                                    {% if manga.tags %}
                                        <div style="display: flex; flex-wrap: wrap; gap: 0.3rem; margin: var(--space-sm) 0;">
                                            {% for tag in manga.tags|slice(0, 2) %}
                                                <span style="background-color: var(--accent-purple); color: white; padding: 0.2rem 0.5rem; border-radius: 8px; font-size: 0.7rem;">{{ tag }}</span>
                                            {% endfor %}
                                        </div>
                                    {% endif %}

                                    <div class="manga-actions">
                                        <span class="btn-read">
                                            üìñ Voir les d√©tails
                                        </span>
                                    </div>
                                </div>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <h3>Aucun manga trouv√©</h3>
                    <p>Impossible de charger les mangas depuis MangaDx pour le moment.</p>
                    <a href="{{ path('app_home') }}" class="btn-primary">
                        üè† Retour √† l'accueil
                    </a>
                </div>
            {% endif %}
        </section>

        <!-- Pagination -->
        {% if totalPages > 1 %}
        <div style="display: flex; justify-content: center; align-items: center; gap: var(--space-md); margin-top: var(--space-xl); padding: var(--space-lg); background-color: var(--bg-card); border-radius: var(--radius-md); border: 1px solid var(--border-color);">
            <!-- Bouton Pr√©c√©dent -->
            {% if hasPrevPage %}
                <a href="{{ path('mangadx_home', {page: currentPage - 1}) }}" class="btn-primary">
                    ‚Üê Pr√©c√©dent
                </a>
            {% else %}
                <span style="padding: var(--space-sm) var(--space-md); color: var(--text-muted); background-color: var(--bg-secondary); border-radius: var(--radius-sm);">
                    ‚Üê Pr√©c√©dent
                </span>
            {% endif %}

            <!-- Num√©ros de pages -->
            <div style="display: flex; gap: 0.5rem; align-items: center;">
                {% if currentPage > 2 %}
                    <a href="{{ path('mangadx_home', {page: 1}) }}" style="padding: 0.5rem 1rem; background-color: var(--bg-secondary); color: var(--text-primary); text-decoration: none; border-radius: 6px; border: 1px solid var(--border-color);">1</a>
                    {% if currentPage > 3 %}
                        <span style="color: var(--text-muted);">...</span>
                    {% endif %}
                {% endif %}

                {% for page in range(max(1, currentPage - 1), min(totalPages, currentPage + 1)) %}
                    {% if page == currentPage %}
                        <span style="padding: 0.5rem 1rem; background-color: var(--accent-purple); color: white; border-radius: 6px; font-weight: 600;">{{ page }}</span>
                    {% else %}
                        <a href="{{ path('mangadx_home', {page: page}) }}" style="padding: 0.5rem 1rem; background-color: var(--bg-secondary); color: var(--text-primary); text-decoration: none; border-radius: 6px; border: 1px solid var(--border-color);">{{ page }}</a>
                    {% endif %}
                {% endfor %}

                {% if currentPage < totalPages - 1 %}
                    {% if currentPage < totalPages - 2 %}
                        <span style="color: var(--text-muted);">...</span>
                    {% endif %}
                    <a href="{{ path('mangadx_home', {page: totalPages}) }}" style="padding: 0.5rem 1rem; background-color: var(--bg-secondary); color: var(--text-primary); text-decoration: none; border-radius: 6px; border: 1px solid var(--border-color);">{{ totalPages }}</a>
                {% endif %}
            </div>

            <!-- Bouton Suivant -->
            {% if hasNextPage %}
                <a href="{{ path('mangadx_home', {page: currentPage + 1}) }}" class="btn-primary">
                    Suivant ‚Üí
                </a>
            {% else %}
                <span style="padding: var(--space-sm) var(--space-md); color: var(--text-muted); background-color: var(--bg-secondary); border-radius: var(--radius-sm);">
                    Suivant ‚Üí
                </span>
            {% endif %}
        </div>

        <div style="text-align: center; margin-top: var(--space-md);">
            <small style="color: var(--text-secondary);">
                Page {{ currentPage }} sur {{ totalPages }} ‚Ä¢ Affichage de {{ mangasPerPage|default(20) }} mangas par page
            </small>
        </div>
        {% endif %}
    </main>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-section">
            <h3 class="sidebar-title">
                üìà ASURA SCANS TRENDING THIS WEEK
            </h3>
            <ul class="trending-list">
                {% set trendingMangas = mangas|slice(0, 8) %}
                {% for manga in trendingMangas %}
                    <li class="trending-item">
                        <div class="trending-rank">{{ loop.index }}</div>
                        <div class="trending-info">
                            <div class="trending-title">{{ manga.title }}</div>
                            <div class="trending-chapters">{{ manga.status|default('En cours') }}</div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Section des actions rapides -->
        <div class="sidebar-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
            <h3 class="sidebar-title">
                ‚ö° Actions Rapides
            </h3>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <a href="{{ path('mangadx_search') }}" class="btn-primary" style="text-align: center;">
                    üîç Rechercher des mangas
                </a>
                <a href="{{ path('app_oeuvre_list') }}" class="btn-primary" style="text-align: center; background: linear-gradient(135deg, #10b981, #059669);">
                    ‚≠ê Mes Favoris
                </a>
            </div>
        </div>

        <!-- Section des statistiques -->
        <div class="sidebar-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
            <h3 class="sidebar-title">
                üìä Statistiques MangaDx
            </h3>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: var(--text-secondary);">Total Mangas</span>
                    <span style="color: var(--accent-purple); font-weight: 600;">{{ totalMangas }}+</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: var(--text-secondary);">Page Actuelle</span>
                    <span style="color: var(--accent-purple); font-weight: 600;">{{ currentPage }}/{{ totalPages }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: var(--text-secondary);">API Status</span>
                    <span style="color: #10b981; font-weight: 600;">‚úÖ En ligne</span>
                </div>
            </div>
        </div>

        <!-- Footer de cr√©dit -->
        <div class="sidebar-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
            <div style="text-align: center; color: var(--text-secondary); font-size: 0.8rem;">
                <p>Donn√©es fournies par <a href="https://mangadx.org" target="_blank" style="color: var(--accent-purple);">MangaDx</a></p>
                <p>Merci aux √©quipes de traduction</p>
            </div>
        </div>
    </aside>
</div>
{% endblock %} 