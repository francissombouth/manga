{% extends 'base.html.twig' %}

{% block title %}Recherche{% if query %} : {{ query }}{% endif %} - MangaTh√®que{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('assets/css/vortex-theme.css') }}">
{% endblock %}

{% block body %}
{% include 'partials/_navigation.html.twig' %}

<section class="search-hero">
    <div class="container">
        <h1>üîç Rechercher des mangas</h1>
        
        <form action="{{ path('mangadx_search') }}" method="GET" class="search-form">
            <input type="text" name="q" class="search-input" placeholder="Rechercher un manga..." value="{{ query }}" required>
            <button type="submit" class="search-btn">üîç Rechercher</button>
        </form>
    </div>
</section>

<section class="results-section">
    <div class="container">
        {% if query %}
            <div class="results-header">
                <h2 class="results-title">R√©sultats pour "{{ query }}"</h2>
                <div class="results-count">{{ mangas|length }} manga(s) trouv√©(s)</div>
            </div>
            
            <div class="alert-info">
                <small>
                    ‚úÖ <strong>Contenu familial</strong> : Seuls les mangas tout public et √† contenu suggestif l√©ger sont affich√©s.
                    <br>Le contenu √©rotique et pornographique est automatiquement exclu.
                </small>
            </div>
            
            {% if mangas|length > 0 %}
            <div class="alert-warning">
                <small>
                    üîÑ <strong>Recherche en temps r√©el</strong> dans la base MangaDx officielle
                    <br>üìÖ R√©sultats du {{ "now"|date("d/m/Y √† H:i") }} ‚Ä¢ üåê API : <code style="color: #00d4ff;">api.mangadx.org</code>
                </small>
            </div>
            {% endif %}
            
            {% if mangas %}
                <div class="mangas-grid">
                    {% for manga in mangas %}
                        <a href="{{ path('mangadx_manga_show', {id: manga.id}) }}" class="manga-card">
                            {% if manga.cover_url %}
                                <img src="{{ path('image_proxy') }}?url={{ manga.cover_url|url_encode }}" 
                                     alt="{{ manga.title }}" 
                                     class="manga-cover" 
                                     loading="lazy" 
                                     onerror="this.src='{{ path('image_proxy') }}';">
                            {% else %}
                                <img src="{{ path('image_proxy') }}" 
                                     alt="{{ manga.title }}" 
                                     class="manga-cover">
                            {% endif %}
                            
                            <!-- Overlay VortexScans style -->
                            <div class="manga-overlay">
                                <div class="manga-title-overlay">{{ manga.title }}</div>
                                {% if manga.authors %}
                                    <div class="manga-author-overlay">par {{ manga.authors|join(', ') }}</div>
                                {% endif %}
                                
                                {% if manga.year %}
                                    <div class="manga-rating">
                                        <span>üìÖ</span>
                                        <span>{{ manga.year }}</span>
                                    </div>
                                {% endif %}
                                
                                <span class="manga-meta-badge">{{ manga.status|title }}</span>
                                
                                {% if manga.tags %}
                                    <div class="manga-genres">
                                        {% for tag in manga.tags|slice(0, 3) %}
                                            <span class="genre-tag">{{ tag }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                
                                {% if manga.description %}
                                    <div class="manga-overlay-description">
                                        {{ manga.description|slice(0, 120) }}{% if manga.description|length > 120 %}...{% endif %}
                                    </div>
                                {% endif %}
                                
                                <div class="manga-overlay-cta">
                                    <span class="cta-text">üìñ Voir les d√©tails</span>
                                </div>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-results">
                    <h3>üòî Aucun r√©sultat trouv√©</h3>
                    <p>Votre recherche "{{ query }}" n'a donn√© aucun r√©sultat.</p>
                    
                    <div class="suggestions">
                        <h4>üí° Suggestions :</h4>
                        <ul>
                            <li>‚Ä¢ V√©rifiez l'orthographe de votre recherche</li>
                            <li>‚Ä¢ Essayez des termes plus g√©n√©raux</li>
                            <li>‚Ä¢ Recherchez en anglais (ex: "One Piece", "Naruto")</li>
                            <li>‚Ä¢ Utilisez le nom de l'auteur</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <a href="{{ path('mangadx_home') }}" class="btn btn-primary">
                            üè† Voir les mangas populaires
                        </a>
                    </div>
                </div>
            {% endif %}
        {% else %}
            <div class="results-header">
                <h2 class="results-title">Recherchez parmi des milliers de mangas</h2>
                <p class="results-count">Utilisez le formulaire ci-dessus pour rechercher vos mangas pr√©f√©r√©s</p>
            </div>
            
            <div class="suggestions">
                <h4>üåü Recherches populaires :</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem;">
                    <a href="{{ path('mangadx_search', {q: 'One Piece'}) }}" class="tag">One Piece</a>
                    <a href="{{ path('mangadx_search', {q: 'Naruto'}) }}" class="tag">Naruto</a>
                    <a href="{{ path('mangadx_search', {q: 'Dragon Ball'}) }}" class="tag">Dragon Ball</a>
                    <a href="{{ path('mangadx_search', {q: 'Attack on Titan'}) }}" class="tag">Attack on Titan</a>
                    <a href="{{ path('mangadx_search', {q: 'Demon Slayer'}) }}" class="tag">Demon Slayer</a>
                    <a href="{{ path('mangadx_search', {q: 'My Hero Academia'}) }}" class="tag">My Hero Academia</a>
                </div>
            </div>
        {% endif %}
    </div>
</section>

<footer class="credit">
    <div class="container">
        <p>
            Donn√©es fournies par <a href="https://mangadex.org" target="_blank">MangaDx</a> ‚Ä¢ 
            Merci aux √©quipes de traduction ‚Ä¢ 
            Application respectant la <a href="https://api.mangadx.org/docs/" target="_blank">politique d'usage MangaDx</a>
        </p>
    </div>
</footer>
{% endblock %} 