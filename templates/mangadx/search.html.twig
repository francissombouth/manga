{% extends 'base.html.twig' %}

{% block title %}Recherche{% if query %} : {{ query }}{% endif %} - MangaTh√®que{% endblock %}

{% block body %}
<div class="main-container">
    <!-- Contenu principal -->
    <main>
        <!-- Header de recherche -->
        <div class="collection-header">
            <h1 class="collection-title">üîç Rechercher des mangas</h1>
            <p class="collection-subtitle">Explorez notre collection de milliers de mangas via l'API MangaDx</p>
            
            <!-- Barre de recherche principale -->
            <div style="margin-top: 2rem;">
                <form action="{{ path('mangadx_search') }}" method="GET" style="display: flex; justify-content: center; gap: 1rem; max-width: 600px; margin: 0 auto;">
                    <input type="text" name="q" placeholder="Rechercher un manga..." value="{{ query }}" 
                           style="flex: 1; padding: 1rem; border-radius: 12px; border: 1px solid var(--border-color); background-color: var(--bg-card); color: var(--text-primary);" required>
                    <button type="submit" class="btn-primary" style="padding: 1rem 2rem; white-space: nowrap;">
                        üîç Rechercher
                    </button>
                </form>
            </div>
            
            {% if query %}
                <div class="collection-stats">
                    <div class="stat-item">
                        <span class="stat-number">{{ mangas|length }}</span>
                        <span class="stat-label">R√©sultats trouv√©s</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">"{{ query }}"</span>
                        <span class="stat-label">Terme recherch√©</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">üìÖ</span>
                        <span class="stat-label">{{ "now"|date("H:i") }}</span>
                    </div>
                </div>
            {% endif %}
        </div>

        {% if query %}
            <!-- Alertes d'information pour les r√©sultats -->
            <div style="background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: var(--space-md); margin-bottom: var(--space-lg);">
                <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-xs);">
                    <span style="color: #10b981;">‚úÖ</span>
                    <strong style="color: var(--text-primary);">Recherche s√©curis√©e</strong>
                </div>
                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">
                    Seuls les mangas tout public et √† contenu suggestif l√©ger sont affich√©s. Le contenu √©rotique et pornographique est automatiquement exclu.
                </p>
                <div style="margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--border-color);">
                    <small style="color: var(--text-muted);">
                        üîÑ R√©sultats du {{ "now"|date("d/m/Y √† H:i") }} ‚Ä¢ 
                        üåê API officielle : <code style="color: var(--accent-purple);">api.mangadx.org</code>
                    </small>
                </div>
            </div>

            <!-- Section des r√©sultats -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        {% if mangas|length > 0 %}
                            üéØ R√©sultats pour "{{ query }}"
                        {% else %}
                            üòî Aucun r√©sultat trouv√©
                        {% endif %}
                    </h2>
                    <a href="{{ path('mangadx_home') }}" class="section-link">VOIR POPULAIRES</a>
                </div>

                {% if mangas|length > 0 %}
                    <div class="manga-grid">
                        {% for manga in mangas %}
                            <div class="manga-card">
                                <a href="{{ path('mangadx_manga_show', {id: manga.id}) }}" style="text-decoration: none; color: inherit;">
                                    <!-- Couverture du manga -->
                                    <div class="manga-cover-container">
                                        {% if manga.cover_url %}
                                            <img src="{{ path('image_proxy') }}?url={{ manga.cover_url|url_encode }}" 
                                                 alt="{{ manga.title }}" 
                                                 class="manga-cover" 
                                                 loading="lazy" 
                                                 onerror="this.src='{{ path('image_proxy') }}';">
                                        {% else %}
                                            <div class="manga-cover" style="background: linear-gradient(45deg, #374151, #4b5563); display: flex; align-items: center; justify-content: center; color: #9ca3af; font-size: 3rem;">
                                                üìñ
                                            </div>
                                        {% endif %}
                                    </div>

                                    <!-- Informations du manga -->
                                    <div class="manga-info">
                                        <h3 class="manga-title">{{ manga.title }}</h3>
                                        <p class="manga-author">
                                            {% if manga.authors %}
                                                {{ manga.authors|join(', ') }}
                                            {% else %}
                                                Auteur inconnu
                                            {% endif %}
                                        </p>

                                        <div class="manga-meta">
                                            <span class="manga-type">{{ manga.status|default('MANGA')|title }}</span>
                                            {% if manga.year %}
                                                <span class="chapters-count">{{ manga.year }}</span>
                                            {% endif %}
                                        </div>

                                        {% if manga.tags %}
                                            <div style="display: flex; flex-wrap: wrap; gap: 0.3rem; margin: var(--space-sm) 0;">
                                                {% for tag in manga.tags|slice(0, 2) %}
                                                    <span style="background-color: var(--accent-purple); color: white; padding: 0.2rem 0.5rem; border-radius: 8px; font-size: 0.7rem;">{{ tag }}</span>
                                                {% endfor %}
                                            </div>
                                        {% endif %}

                                        {% if manga.description %}
                                            <div style="color: var(--text-secondary); font-size: 0.85rem; margin: var(--space-sm) 0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                                {{ manga.description|slice(0, 100) }}{% if manga.description|length > 100 %}...{% endif %}
                                            </div>
                                        {% endif %}

                                        <div class="manga-actions">
                                            <span class="btn-read">
                                                üìñ Voir les d√©tails
                                            </span>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <h3>üòî Aucun r√©sultat trouv√©</h3>
                        <p>Votre recherche "{{ query }}" n'a donn√© aucun r√©sultat.</p>
                        
                        <div style="background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: var(--space-lg); margin: var(--space-lg) 0; text-align: left;">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--space-md);">üí° Suggestions :</h4>
                            <ul style="color: var(--text-secondary); margin: 0; padding-left: var(--space-lg);">
                                <li>V√©rifiez l'orthographe de votre recherche</li>
                                <li>Essayez des termes plus g√©n√©raux</li>
                                <li>Recherchez en anglais (ex: "One Piece", "Naruto")</li>
                                <li>Utilisez le nom de l'auteur</li>
                            </ul>
                        </div>
                        
                        <a href="{{ path('mangadx_home') }}" class="btn-primary">
                            üî• Voir les mangas populaires
                        </a>
                    </div>
                {% endif %}
            </section>
        {% else %}
            <!-- Section suggestions quand pas de recherche -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        üåü Recherches populaires
                    </h2>
                    <a href="{{ path('mangadx_home') }}" class="section-link">VOIR POPULAIRES</a>
                </div>

                <div style="background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: var(--space-xl);">
                    <p style="color: var(--text-secondary); margin-bottom: var(--space-lg); text-align: center;">
                        Utilisez le formulaire ci-dessus pour rechercher vos mangas pr√©f√©r√©s parmi des milliers de titres
                    </p>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center;">
                        <a href="{{ path('mangadx_search', {q: 'One Piece'}) }}" class="btn-primary" style="font-size: 0.9rem;">One Piece</a>
                        <a href="{{ path('mangadx_search', {q: 'Naruto'}) }}" class="btn-primary" style="font-size: 0.9rem;">Naruto</a>
                        <a href="{{ path('mangadx_search', {q: 'Dragon Ball'}) }}" class="btn-primary" style="font-size: 0.9rem;">Dragon Ball</a>
                        <a href="{{ path('mangadx_search', {q: 'Attack on Titan'}) }}" class="btn-primary" style="font-size: 0.9rem;">Attack on Titan</a>
                        <a href="{{ path('mangadx_search', {q: 'Demon Slayer'}) }}" class="btn-primary" style="font-size: 0.9rem;">Demon Slayer</a>
                        <a href="{{ path('mangadx_search', {q: 'My Hero Academia'}) }}" class="btn-primary" style="font-size: 0.9rem;">My Hero Academia</a>
                    </div>
                </div>
            </section>
        {% endif %}
    </main>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-section">
            <h3 class="sidebar-title">
                üîç RECHERCHE AVANC√âE
            </h3>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <form action="{{ path('mangadx_search') }}" method="GET" style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <input type="text" name="q" placeholder="Titre du manga..." value="{{ query }}" 
                           style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--bg-card); color: var(--text-primary); font-size: 0.85rem;">
                    <button type="submit" class="btn-primary" style="font-size: 0.8rem; padding: 0.5rem;">
                        üîç Rechercher
                    </button>
                </form>
            </div>
        </div>

        <!-- Section des suggestions -->
        <div class="sidebar-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
            <h3 class="sidebar-title">
                ‚ö° Actions Rapides
            </h3>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <a href="{{ path('mangadx_home') }}" class="btn-primary" style="text-align: center; font-size: 0.85rem;">
                    üî• Mangas Populaires
                </a>
                <a href="{{ path('app_oeuvre_list') }}" class="btn-primary" style="text-align: center; background: linear-gradient(135deg, #10b981, #059669); font-size: 0.85rem;">
                    ‚≠ê Mes Favoris
                </a>
            </div>
        </div>

        <!-- Section des genres populaires -->
        <div class="sidebar-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
            <h3 class="sidebar-title">
                üé≠ Genres Populaires
            </h3>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <a href="{{ path('mangadx_search', {q: 'Action'}) }}" style="color: var(--text-secondary); text-decoration: none; padding: 0.3rem 0; border-bottom: 1px solid var(--border-color); font-size: 0.85rem;">Action</a>
                <a href="{{ path('mangadx_search', {q: 'Romance'}) }}" style="color: var(--text-secondary); text-decoration: none; padding: 0.3rem 0; border-bottom: 1px solid var(--border-color); font-size: 0.85rem;">Romance</a>
                <a href="{{ path('mangadx_search', {q: 'Fantasy'}) }}" style="color: var(--text-secondary); text-decoration: none; padding: 0.3rem 0; border-bottom: 1px solid var(--border-color); font-size: 0.85rem;">Fantasy</a>
                <a href="{{ path('mangadx_search', {q: 'Isekai'}) }}" style="color: var(--text-secondary); text-decoration: none; padding: 0.3rem 0; border-bottom: 1px solid var(--border-color); font-size: 0.85rem;">Isekai</a>
                <a href="{{ path('mangadx_search', {q: 'School Life'}) }}" style="color: var(--text-secondary); text-decoration: none; padding: 0.3rem 0; font-size: 0.85rem;">School Life</a>
            </div>
        </div>

        <!-- Footer de cr√©dit -->
        <div class="sidebar-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
            <div style="text-align: center; color: var(--text-secondary); font-size: 0.8rem;">
                <p>Donn√©es fournies par <a href="https://mangadx.org" target="_blank" style="color: var(--accent-purple);">MangaDx</a></p>
                <p>Merci aux √©quipes de traduction</p>
            </div>
        </div>
    </aside>
</div>
{% endblock %} 